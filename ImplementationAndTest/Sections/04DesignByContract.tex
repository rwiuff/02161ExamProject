% !TeX root = ..\rapport_13_2.tex
\section{Design by contract}

\subsection{generateProjectNumber}
pre: 
\begin{equation}
    pr \neq null \land date \neq null
\end{equation}

post:
\begin{equation}
    \text{result }=\{s|\exists p \in projectRepository.getProjectNumbers : s \in p \land p = largestProjectNumber(date)\}
\end{equation}
Med asserts ser det ud som følger:
\begin{figure}[H]
    \centering
    \caption{generateProjectNumber med asserts}
    \includegraphics[width = 14cm, keepaspectratio]{ImplementationAndTest/Diagrams/contract_generateProjectNumber.png}
    \label{fig:contract_generateProjectNumber}
\end{figure}




\subsection{createProjectActivity}
pre: 
\begin{equation}
    title \neq null \wedge startWeek \neq null \wedge endWeek \neq null \wedge loggedInUser \neq null \wedge activities \neq null
\end{equation}

post: 
\begin{equation}
\begin{gathered}
    activity \in activities \wedge \\
    \neg project@pre.hasProjectActivity(title) \wedge \\
    (hasProjectLeader() \to projectLeader.isSameAs(loggedInUser))
\end{gathered}
\end{equation}

\begin{listing}[H]
    \centering
    \caption{createProjectActivity() kildekode med assertions}\label{lst:create_project_activity_assertions}
    \begin{minted}[breaklines]{java}
  public ProjectActivity createProjectActivity(String title, String startWeek, String endWeek, Employee loggedInUser)
      throws AlreadyExistsException, OperationNotAllowedException, InvalidPropertyException {

    assert title != null;
    assert startWeek != null;
    assert endWeek != null;
    assert loggedInUser != null;
    assert activities != null;

    if (hasProjectLeader()) {
      if (!projectLeader.isSameAs(loggedInUser)) {
        throw new OperationNotAllowedException("Kun projektlederen kan oprette en projekt aktivitet for dette projekt");
      }
    }

    if (hasProjectActivity(title)) {
      throw new AlreadyExistsException("Projekt aktivitet findes allerede");
    }

    ProjectActivity activity = new ProjectActivity(title, startWeek, endWeek);
    this.activities.add(activity);

    /**
     * NOTE: This post condition does not check for 
     * !project@pre.hasProjectActivity(title)
     */
    assert (
      activities.contains(activity) &&
      (!hasProjectLeader() || projectLeader.isSameAs(loggedInUser) )
    );

    return activity;
  }
    \end{minted}
\end{listing}


\subsection{findWorkTimeRegistrationById()}

Det er en noget triviel postcondition, især med et if-statement af samme grad lige før. Desuden, skal det være sådan, at man ogås har postconditions for exceptions?

pre: 
\begin{equation}
    allWorkTimeRegistrations().size()\; >\; 0 \;\wedge\; id \; \in \; \mathbb{N}
\end{equation}
post: 
\begin{equation}
    \exists i\; :\; (i\; \in\; result\; \iff\; \exists worktimeRegistration.getId() \; = \; i)
\end{equation}

\begin{listing}[H]
    \centering
    \caption{findWorkTimeRegistrationById() kildekode med assertions}\label{lst:find_work_time_registration_by_id_assertions}
    \begin{minted}[breaklines]{java}
public WorktimeRegistration findWorktimeRegistrationById(int id) throws NotFoundException {

    assert allWorkTimeRegistrations().size() > 0 && id == (int) id && id >= 0 // Precondition
    
    List<WorktimeRegistration> list = allWorktimeRegistrations();

    for (WorktimeRegistration worktimeRegistration : list) {
        if (worktimeRegistration.getId().equals(id)) {
            assert worktimeRegistration.getId().equals(id) // Postcondition
            
            return worktimeRegistration;
        }
    }

    throw new NotFoundException("Ukendt tidsregistrering");

}
    \end{minted}
\end{listing}


